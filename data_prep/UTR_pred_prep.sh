awk -v OFS="\t" '$3=="UTR"{print $1,$4,$5,$12,0,$7}' gencode.v39.primary_assembly.annotation.gtf | tr -d '";' | awk 'BEGIN{while(getline < "appris_data.principal_gencode_v39.txt"){d[$3]=$3}}{split($4,a,".");if(a[1] in d){print $0}}' | awk -v OFS="\t" 'BEGIN{while(getline < "gencode_transcript_tid.bed"){start[$4]=$2;end[$4]=$3}}{d1=$2-start[$4];d2=end[$4]-$3;if(d1>d2){if($6=="+")region="UTR3";else{region="UTR5"}}if(d1<d2){if($6=="+")region="UTR5";else{region="UTR3"}}print $1,$2,$3,$4"_"region,$5,$6}' > principal_pc_transcripts_UTR.bed

gawk -v OFS="\t" '$3=="UTR"{print $1,$4,$5,$12,0,$7}' gencode.v39.primary_assembly.annotation.gtf | tr -d '";' | awk 'BEGIN{while(getline < "appris_data.principal_gencode_v39.txt"){d[$3]=$3}}{split($4,a,".");if(a[1] in d){print $0}}' | awk -v OFS="\t" 'BEGIN{while(getline < "gencode_transcript_tid.bed"){start[$4]=$2;end[$4]=$3}}{d1=$2-start[$4];d2=end[$4]-$3;if(d1>d2){if($6=="+"){if($4 in UTR3){UTR3[$4]=UTR3[$4]+$3-$2+1}else{UTR3[$4]=$3-$2+1}}else{if($4 in UTR5){UTR5[$4]=UTR5[$4]+$3-$2+1}else{UTR5[$4]=$3-$2+1}}}if(d1<d2){if($6=="+"){if($4 in UTR5){UTR5[$4]=UTR5[$4]+$3-$2+1}else{UTR5[$4]=$3-$2+1}}else{if($4 in UTR3){UTR3[$4]=UTR3[$4]+$3-$2+1}else{UTR3[$4]=$3-$2+1}}}d[$4]=$4}END{for(k in d){l1=0;l2=0;if(k in UTR5){l1=UTR5[k]}if(k in UTR3){l2=UTR3[k]}print k,l1,l2}}' > principal_pc_transcripts_UTR_length.txt


awk 'BEGIN{while(getline < "principal_pc_transcripts_UTR_length.txt"){d[$1]=$1;l1[$1]=$2;l2[$1]=$3}}NR%2==1{gsub(">","",$0);split($0,a,"|");tid=a[1]}NR%2==0{if(tid in d){if(l1[tid]!=0){if(l1[tid]<50){lstr=50}else{lstr=l1[tid]}seq=substr($0,1,lstr);if(seq in name){name[seq]=name[seq]","tid"_UTR5"}else{name[seq]=tid"_UTR5"}}if(l2[tid]!=0){if(l2[tid]<50){lstr=50}else{lstr=l2[tid]}seq=substr($0,length($0)-lstr+1,lstr);if(seq in name){name[seq]=name[seq]","tid"_UTR3"}else{name[seq]=tid"_UTR3"}}}}END{for(k in name){print k"\t"name[k]}}' transcripts.fa > principal_pc_transcripts_UTR_seq.txt


cat principal_pc_transcripts_UTR_seq.txt | awk -v OFS="\t" '{if(length($1)<100){print $1,$2}else{for(i=1;i<=length($1)-50;i=i+50){if(i+100<=length($1)){print substr($1,i,100),$2}else{print substr($1,length($1)-99,100),$2}}}}' > principal_pc_transcripts_UTR_seq_100.txt